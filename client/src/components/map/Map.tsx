import React from 'react';
import { MapContainer, TileLayer, Circle, Polyline } from 'react-leaflet';

type Shock = {
  id: number;
  timestamp: string;
  zAccel: number;
  userId: number;
  latitude: number;
  longitude: number;
  altitude: number;
};

type Route = {
  id: number;
  user_id: number;
  latitude: number[];
  longitude: number[];
  altitude: number[];
};

export type MapComponentProps = {
  routes: Route[];
  shocks: Shock[];
};

const MapComponent: React.FC<MapComponentProps> = ({ routes, shocks }) => {
  const mapRef = React.useRef(null);

  const userId = localStorage.getItem('userId');

  return (
    <div className="flex justify-center pt-24 text-center align-middle">
      <MapContainer
        ref={mapRef}
        className="map"
        center={[44.8, -0.6]}
        zoom={12}
        scrollWheelZoom={false}
        style={{ zIndex: 30 }}
      >
        <TileLayer
          attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
        />

        {shocks.map((shock: Shock) => (
          <Circle
            center={[shock.latitude, shock.longitude]}
            radius={1}
            color={
              shock.userId === Number(userId)
                ? 'green'
                : Math.abs(shock.zAccel) > 4
                  ? 'red'
                  : 'blue'
            }
          />
        ))}

        {routes.map((route) => (
          <Polyline
            pathOptions={{ color: 'blue' }}
            positions={route.latitude.map((lat, i) => [
              lat,
              route.longitude[i],
            ])}
          />
        ))}
      </MapContainer>
    </div>
  );
};

export default MapComponent;

const shockSample = [
  {
    id: 1,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -1.139336068711178,
    userId: 1,
    latitude: 44.8004417,
    longitude: -0.6057561,
    altitude: 72.30000305175781,
  },
  {
    id: 2,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -2.139336068711178,
    userId: 1,
    latitude: 44.8004598,
    longitude: -0.6056892,
    altitude: 72.30000305175781,
  },
  {
    id: 3,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -4.139336068711178,
    userId: 1,
    latitude: 44.8004776,
    longitude: -0.6056233,
    altitude: 72.30000305175781,
  },
  {
    id: 4,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -4.139336068711178,
    userId: 1,
    latitude: 44.8004955,
    longitude: -0.6055564,
    altitude: 72.30000305175781,
  },
  {
    id: 5,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -4.139336068711178,
    userId: 1,
    latitude: 44.8005123,
    longitude: -0.6054893,
    altitude: 72.30000305175781,
  },
  {
    id: 6,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -4.139336068711178,
    userId: 1,
    latitude: 44.8005287,
    longitude: -0.6054211,
    altitude: 72.30000305175781,
  },
  {
    id: 7,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -2.139336068711178,
    userId: 1,
    latitude: 44.8005436,
    longitude: -0.6053569,
    altitude: 72.30000305175781,
  },
  {
    id: 8,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -4.139336068711178,
    userId: 1,
    latitude: 44.8005588,
    longitude: -0.605295,
    altitude: 72.30000305175781,
  },
  {
    id: 9,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -4.139336068711178,
    userId: 1,
    latitude: 44.8005748,
    longitude: -0.6052315,
    altitude: 72.30000305175781,
  },
  {
    id: 10,
    timestamp: '2024-10-14T13:40:02',
    zAccel: -4.139336068711178,
    userId: 1,
    latitude: 44.8005992,
    longitude: -0.6051776,
    altitude: 72.30000305175781,
  },
];

const routes_sample = [
  {
    id: 1,
    user_id: 1,
    latitude: [
      44.7980502, 44.7978794, 44.7978966, 44.7978876, 44.7978777, 44.7978644,
      44.7978635, 44.7978793, 44.797903, 44.7979233, 44.7979577, 44.7979861,
      44.7980053, 44.7980279, 44.7980558, 44.7980786, 44.7980992, 44.7981269,
      44.7981508, 44.7981732, 44.7981975, 44.7982232, 44.7982508, 44.7982764,
      44.798299, 44.7983257, 44.7983624, 44.7984016, 44.798441, 44.798481,
      44.7985214, 44.7985624, 44.7986044, 44.7986479, 44.7986927, 44.7987389,
      44.7987857, 44.7988335, 44.7988817, 44.7989316, 44.7989809, 44.7990294,
      44.7990775, 44.7991257, 44.7991718, 44.7992165, 44.7992608, 44.7993046,
      44.7993403, 44.7993645, 44.7993821, 44.799399, 44.7994197, 44.7994488,
      44.7994851, 44.7995232, 44.7995607, 44.7995946, 44.7996162, 44.7996328,
      44.7996541, 44.799673, 44.7996843, 44.7996972, 44.7997166, 44.7997494,
      44.7997862, 44.7998253, 44.7998635, 44.7998959, 44.7999253, 44.7999552,
      44.7999854, 44.8000161, 44.8000457, 44.8000733, 44.8001028, 44.8001385,
      44.8001749, 44.800205, 44.8002268, 44.8002459, 44.8002642, 44.8002812,
      44.8002972, 44.8003117, 44.8003299, 44.8003497, 44.8003683, 44.8003865,
      44.8004045, 44.800423, 44.8004417, 44.8004598, 44.8004776, 44.8004955,
      44.8005123, 44.8005287, 44.8005436, 44.8005588, 44.8005748, 44.8005992,
      44.8006343, 44.8006703, 44.8007011, 44.8007292, 44.8007577, 44.8007916,
      44.8008309, 44.8008726, 44.8009145, 44.8009581, 44.8010015, 44.8010459,
      44.8010903, 44.8011354, 44.8011812, 44.8012267, 44.8012722, 44.8013184,
      44.801365, 44.801413, 44.8014615, 44.8015103, 44.80156, 44.8016098,
      44.8016593, 44.8017088, 44.8017579, 44.8018075, 44.8018576, 44.8019086,
      44.8019589, 44.8020088, 44.8020593, 44.8021093, 44.8021595, 44.8022106,
      44.8022608, 44.8023119, 44.8023627, 44.8024132, 44.8024639, 44.8025147,
      44.8025653, 44.8026157, 44.8026661, 44.8027145, 44.8027607, 44.8028064,
      44.8028497, 44.8028909, 44.8029301, 44.8029704, 44.8029796, 44.8030116,
      44.8030576, 44.8031043, 44.8031521, 44.8032014, 44.8032509, 44.8033007,
      44.8033495, 44.8033914, 44.8034209, 44.8034447, 44.8034733, 44.8035061,
      44.80354, 44.8035772, 44.8036163, 44.8036578, 44.8036993, 44.8037409,
      44.8037827, 44.8038249, 44.803868, 44.8039115, 44.803955, 44.8039995,
      44.8040462, 44.8040953, 44.8041432, 44.8041895, 44.8042339, 44.8042767,
      44.8043168, 44.8043519, 44.8043822, 44.8044029, 44.8044184, 44.804428,
      44.8044382, 44.8044554, 44.8044795, 44.8045076, 44.8045375, 44.8045624,
      44.804594, 44.8046282, 44.8046675, 44.8047137, 44.8047622, 44.8048101,
      44.8048545, 44.8048996, 44.8049454, 44.8049911, 44.8050342, 44.8050767,
      44.8051191, 44.8051597, 44.805199, 44.8052361, 44.8052716, 44.8053069,
      44.8053384, 44.8053679, 44.8053971, 44.8054266, 44.8054549, 44.8054898,
      44.8055388, 44.8055903, 44.8056403, 44.8056851, 44.805726, 44.8057727,
      44.8058255, 44.8058749, 44.8059173, 44.8059542, 44.8059893, 44.8060214,
      44.8060566, 44.8060894, 44.8061208, 44.8061533, 44.8061858, 44.8062187,
      44.8062512, 44.8062804, 44.8063114, 44.8063402, 44.8063693, 44.8063971,
      44.8064228, 44.8064461, 44.8064697, 44.8064882, 44.8065057, 44.8065213,
      44.8065388, 44.8065575, 44.8065748, 44.8065862,
    ],
    longitude: [
      -0.6078085, -0.607863, -0.6078474, -0.6078251, -0.6078136, -0.6077962,
      -0.60781, -0.6078409, -0.6078381, -0.6078298, -0.607809, -0.6077886,
      -0.6077642, -0.6077329, -0.6076901, -0.6076544, -0.6076277, -0.6075998,
      -0.6075772, -0.6075548, -0.6075299, -0.6075045, -0.607479, -0.6074617,
      -0.6074513, -0.6074467, -0.6074449, -0.6074309, -0.6073985, -0.6073625,
      -0.6073234, -0.6072844, -0.6072461, -0.6072064, -0.6071664, -0.6071261,
      -0.6070853, -0.6070435, -0.6069994, -0.6069533, -0.6069082, -0.6068647,
      -0.6068224, -0.606781, -0.6067394, -0.6066965, -0.6066548, -0.6066147,
      -0.6065839, -0.6065652, -0.6065506, -0.6065349, -0.6065189, -0.6065074,
      -0.6064907, -0.606458, -0.6064235, -0.6063897, -0.6063536, -0.6063197,
      -0.6062949, -0.6062782, -0.6062655, -0.6062503, -0.6062306, -0.6062119,
      -0.6061937, -0.6061868, -0.6062051, -0.6062451, -0.6062928, -0.6063415,
      -0.6063901, -0.6064372, -0.6064839, -0.6065296, -0.6065688, -0.6065876,
      -0.6065746, -0.6065402, -0.6064901, -0.6064349, -0.6063774, -0.6063173,
      -0.6062571, -0.6061974, -0.6061399, -0.6060809, -0.6060184, -0.6059532,
      -0.6058876, -0.6058216, -0.6057561, -0.6056892, -0.6056233, -0.6055564,
      -0.6054893, -0.6054211, -0.6053569, -0.605295, -0.6052315, -0.6051776,
      -0.6051412, -0.6051219, -0.6051114, -0.6051033, -0.6051042, -0.6051194,
      -0.6051387, -0.6051562, -0.6051746, -0.6051936, -0.605217, -0.605243,
      -0.6052685, -0.6052948, -0.6053199, -0.605346, -0.6053738, -0.6054037,
      -0.6054348, -0.6054638, -0.6054915, -0.6055199, -0.6055483, -0.6055761,
      -0.6056041, -0.605632, -0.6056615, -0.6056912, -0.6057193, -0.605747,
      -0.605776, -0.605805, -0.6058339, -0.6058636, -0.6058918, -0.60592,
      -0.6059482, -0.6059767, -0.6060053, -0.6060332, -0.6060605, -0.6060863,
      -0.6061123, -0.6061393, -0.6061678, -0.6061956, -0.6062217, -0.6062458,
      -0.6062699, -0.6062964, -0.6063228, -0.6063462, -0.6063509, -0.6063649,
      -0.6063858, -0.6064053, -0.6064254, -0.6064485, -0.6064755, -0.6065044,
      -0.6065315, -0.6065499, -0.6065604, -0.6065727, -0.6065736, -0.6065577,
      -0.606536, -0.6065186, -0.6065053, -0.6064922, -0.6064745, -0.6064501,
      -0.6064222, -0.6063941, -0.606368, -0.6063397, -0.6063113, -0.6062817,
      -0.6062501, -0.6062183, -0.6061875, -0.6061579, -0.6061295, -0.6061021,
      -0.6060743, -0.6060481, -0.6060358, -0.6060459, -0.6060701, -0.606102,
      -0.606133, -0.606161, -0.6061855, -0.6061947, -0.6061982, -0.6061614,
      -0.6061243, -0.6060879, -0.6060513, -0.6060177, -0.6059797, -0.6059336,
      -0.6058798, -0.6058235, -0.6057665, -0.6057055, -0.6056408, -0.6055735,
      -0.6055077, -0.6054403, -0.6053691, -0.6052961, -0.605221, -0.6051458,
      -0.605069, -0.6049902, -0.6049114, -0.6048349, -0.6047623, -0.6047042,
      -0.6046683, -0.6046674, -0.6046703, -0.6046449, -0.6046135, -0.6045821,
      -0.6045734, -0.6045892, -0.6046141, -0.6046404, -0.604663, -0.6046839,
      -0.6047045, -0.6047223, -0.6047396, -0.6047528, -0.6047667, -0.6047785,
      -0.6047838, -0.604794, -0.6048055, -0.6048195, -0.6048342, -0.6048497,
      -0.6048639, -0.6048755, -0.6048859, -0.6048925, -0.6048993, -0.6049053,
      -0.6049132, -0.6049219, -0.6049231, -0.604912,
    ],
    altitude: [
      74.0999984741211, 74.0999984741211, 74.0999984741211, 74.0999984741211,
      74.0999984741211, 74.0999984741211, 74.0999984741211, 74.0999984741211,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 74.19999694824219,
      74.19999694824219, 74.19999694824219, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      72.30000305175781, 72.30000305175781, 72.30000305175781,
      71.74255929491775, 71.41778109306851, 71.26677374967484,
      71.13231738779727, 71.11990613729442, 70.85306858373754, 70.5821024864607,
      70.32148666134012, 69.78993759499997, 69.7382322407381, 69.74443686683647,
      69.87059856839092, 69.85405266601838, 69.86232561322493,
      69.82923387214709, 69.79821048053032, 69.7692554159917, 69.78786937486083,
      69.88507625907988, 69.99883039113806, 70.10224454417002, 70.1704985663923,
      70.2656414405991, 70.27805145831378, 70.32355500981372, 70.32355500981372,
      70.31114492643631, 70.30287154746654, 70.30287154746654,
      70.22013819552434, 70.13740563948298, 70.09596240783132,
      70.01943737931171, 70.04011975230368, 70.13525930871593,
      70.16421503479498, 70.07527990054162, 70.0049597478135, 70.01323267711405,
      69.81682450207158, 70.10009891525792, 70.26556084383276,
      70.40206933148957, 70.43516262451186, 70.34423852190537,
      70.57374217219511, 70.66268246137345, 70.71852915957038,
      70.63786182302744, 70.4393833182502, 70.53659756693968, 70.63786182302744,
      70.63372505693437, 70.6026993746629, 70.37112716199383, 70.36905880207918,
      70.36905880207918, 70.38353733192884, 70.5530585158416, 70.47661417727062,
      70.5138451974706, 70.5138451974706, 70.44765682854815, 70.3773322447228,
      70.18084013216706, 70.03399106364319, 70.04226418394829,
      70.25323144079269, 70.5303923692963, 70.61106028788436, 70.61933396334405,
      70.81169916170063, 70.90891761915988, 71.04957605610336,
      71.31228253293236, 71.48190830125546, 71.65360608371489,
      71.75290275128268, 72.09838134080435, 72.31974318124551,
      72.41077213339769, 72.5038709220001, 72.56386845313159, 72.7190364230011,
      72.92800037957683, 73.03144976182747, 73.11214114385037,
      73.21352369702717, 73.47008896681557, 73.5880287958741, 73.61492757988901,
      73.52802411932538, 73.47215807268454, 73.45767434205493,
      73.48457271835336, 73.54250796843631, 73.5880287958741, 73.74735358939554,
    ],
  },
];
